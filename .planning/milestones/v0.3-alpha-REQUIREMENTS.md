# Requirements Archive: v0.3-alpha No Duplicate Reports

**Archived:** 2026-01-24
**Status:** SHIPPED

This is the archived requirements specification for v0.3-alpha.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: UniFi Scanner

**Defined:** 2026-01-24
**Core Value:** Translate cryptic UniFi logs into understandable findings with actionable remediation steps for serious issues

## v0.3-alpha Requirements

Requirements for duplicate report prevention milestone.

### State Tracking

- [x] **STATE-01**: Service tracks timestamp of last successful report delivery
- [x] **STATE-02**: Service only processes events that occurred after last report time
- [x] **STATE-03**: State persists in reports directory as `.last_run.json`
- [x] **STATE-04**: State file uses atomic writes to prevent corruption
- [x] **STATE-05**: Missing state file treated as first run (24h lookback)
- [x] **STATE-06**: Corrupted state file treated as first run with warning log
- [x] **STATE-07**: Clock skew tolerance of 5 minutes for late-arriving events

### Configuration

- [x] **CONF-01**: First-run lookback window configurable via `UNIFI_INITIAL_LOOKBACK_HOURS` (default: 24)
- [x] **CONF-02**: Empty report sends confirmation message "No new security events since last report"

## Validated Requirements (v0.2-alpha)

These requirements shipped and are working.

### Log Collection
- [x] **COLL-01**: Service connects to UniFi Controller via API
- [x] **COLL-02**: Service auto-detects device type (UDM Pro, UCG Ultra, self-hosted)
- [x] **COLL-03**: Service handles session expiration with automatic re-authentication
- [x] **COLL-04**: Service falls back to SSH when API is insufficient

### Analysis
- [x] **ANLZ-01**: Service categorizes issues by severity (low, medium, severe)
- [x] **ANLZ-02**: Service generates plain English explanations for log events
- [x] **ANLZ-03**: Service provides step-by-step remediation for severe issues
- [x] **ANLZ-04**: Service deduplicates repeated events and shows occurrence counts

### Reports
- [x] **REPT-01**: Service generates HTML formatted reports
- [x] **REPT-02**: Service generates plain text reports
- [x] **REPT-03**: Service delivers reports via SMTP email
- [x] **REPT-04**: Service saves reports to configurable directory

### Deployment
- [x] **DEPL-01**: Service runs as Docker container
- [x] **DEPL-02**: Service configurable via environment variables
- [x] **DEPL-03**: Service supports YAML configuration file
- [x] **DEPL-04**: Service runs on configurable schedule (daily/weekly)

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| STATE-01 | Phase 6 | Complete |
| STATE-02 | Phase 6 | Complete |
| STATE-03 | Phase 6 | Complete |
| STATE-04 | Phase 6 | Complete |
| STATE-05 | Phase 6 | Complete |
| STATE-06 | Phase 6 | Complete |
| STATE-07 | Phase 6 | Complete |
| CONF-01 | Phase 6 | Complete |
| CONF-02 | Phase 6 | Complete |

---

## Milestone Summary

**Shipped:** 9 of 9 v0.3-alpha requirements
**Adjusted:** None
**Dropped:** None

All requirements delivered exactly as specified:
- StateManager tracks last successful run timestamp
- Timestamp filtering prevents duplicate events across runs
- Atomic writes prevent state corruption
- Graceful fallback for missing/corrupted state
- Configurable initial lookback hours
- Empty reports handled with confirmation message

---
*Archived: 2026-01-24 as part of v0.3-alpha milestone completion*
