---
phase: 09-device-health
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/unifi_scanner/analysis/device_health/__init__.py
  - src/unifi_scanner/analysis/device_health/models.py
  - tests/test_device_health_models.py
autonomous: true

must_haves:
  truths:
    - "DeviceStats can parse real UniFi stat/device API responses"
    - "DeviceHealthFinding captures health issues with threshold context"
    - "DeviceHealthResult groups findings by severity with device summaries"
    - "Models handle missing/None fields gracefully"
  artifacts:
    - path: "src/unifi_scanner/analysis/device_health/models.py"
      provides: "DeviceStats, DeviceHealthFinding, DeviceHealthResult models"
      min_lines: 120
    - path: "tests/test_device_health_models.py"
      provides: "Model parsing and factory tests"
      min_lines: 80
  key_links:
    - from: "DeviceStats.from_api_response"
      to: "raw stat/device dict"
      via: "factory method"
      pattern: "from_api_response.*Dict"
---

<objective>
Create Pydantic and dataclass models for device health monitoring with TDD approach.

Purpose: Provide type-safe data structures for parsing UniFi stat/device API responses and representing health analysis results. Following Phase 8's IPSEvent pattern.

Output: DeviceStats pydantic model with from_api_response factory, DeviceHealthFinding for individual issues, DeviceHealthResult for aggregated analysis output.
</objective>

<execution_context>
@/Users/trekkie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/trekkie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-device-health/09-RESEARCH.md

# Reference Phase 8 model pattern
@src/unifi_scanner/analysis/ips/models.py
</context>

<feature>
  <name>Device Health Models</name>
  <files>
    src/unifi_scanner/analysis/device_health/__init__.py
    src/unifi_scanner/analysis/device_health/models.py
    tests/test_device_health_models.py
  </files>
  <behavior>
    DeviceStats.from_api_response() parses raw stat/device response:
    - Extracts mac, name, model, device_type from top-level fields
    - Extracts cpu_percent, memory_percent from system-stats nested object
    - Parses temperature from temps dict (string "72 C" format) or general_temperature
    - Computes uptime_display and uptime_days from uptime_seconds
    - Handles missing fields with None defaults

    Test cases:
    - Full device response with all fields -> all properties populated
    - Missing system-stats -> cpu/memory are None
    - Temperature in temps dict "72 C" format -> parses to float 72.0
    - Temperature in general_temperature field -> uses that value
    - No temperature data -> temperature_c is None, has_temperature is False
    - Uptime 90 days (7776000 seconds) -> uptime_display = "90d 0h 0m", uptime_days = 90.0
    - Uptime 0 -> uptime_display = "0m", uptime_days = 0.0

    DeviceHealthFinding captures:
    - device_mac, device_name, severity, category (temp/poe/uptime/cpu/memory)
    - title, description, current_value, threshold_value
    - Optional remediation text
    - is_critical property returns True when severity == SEVERE

    DeviceHealthResult aggregates:
    - critical_findings, warning_findings lists
    - device_summaries list (DeviceHealthSummary per device)
    - Counters: total_devices, healthy_devices, devices_with_warnings, devices_with_critical
    - has_issues property returns True if any findings exist
  </behavior>
  <implementation>
    1. Create src/unifi_scanner/analysis/device_health/ directory
    2. Create __init__.py with exports
    3. Create models.py with:
       - DeviceStats (pydantic BaseModel) with from_api_response classmethod
       - DeviceHealthFinding (dataclass) for individual health issues
       - DeviceHealthSummary (dataclass) for per-device status
       - DeviceHealthResult (dataclass) for complete analysis output
    4. Tests verify all parsing edge cases and computed properties
  </implementation>
</feature>

<verification>
```bash
# Run model tests
python -m pytest tests/test_device_health_models.py -v

# Verify module imports
python -c "from unifi_scanner.analysis.device_health import DeviceStats, DeviceHealthFinding, DeviceHealthResult; print('OK')"
```
</verification>

<success_criteria>
- All model tests pass
- DeviceStats correctly parses temperature strings like "72 C"
- uptime_display formats correctly for various durations
- Missing API fields handled without exceptions
- Module exports work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/09-device-health/09-01-SUMMARY.md`
</output>
