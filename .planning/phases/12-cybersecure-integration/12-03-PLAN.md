---
phase: 12-cybersecure-integration
plan: 03
type: execute
wave: 2
depends_on: ["12-02"]
files_modified:
  - src/unifi_scanner/reports/templates/threat_section.html
autonomous: true

must_haves:
  truths:
    - "Threats with is_cybersecure=True display a CyberSecure badge"
    - "Threats with is_cybersecure=False do not display a badge"
    - "Badge appears next to threat category name in both detected and blocked sections"
  artifacts:
    - path: "src/unifi_scanner/reports/templates/threat_section.html"
      provides: "Cybersecure badge conditional rendering"
      contains: "badge-cybersecure"
  key_links:
    - from: "ThreatSummary.is_cybersecure"
      to: "threat_section.html badge"
      via: "jinja2 conditional"
      pattern: "if threat.is_cybersecure"
---

<objective>
Add Cybersecure badge display to threat_section template

Purpose: Visually indicate which threat findings were detected by Cybersecure enhanced signatures
Output: threat_section.html template with conditional badge rendering for Cybersecure threats
</objective>

<execution_context>
@/Users/trekkie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/trekkie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-cybersecure-integration/12-RESEARCH.md

# Prior plan output - ThreatSummary now has is_cybersecure field
@.planning/phases/12-cybersecure-integration/12-02-SUMMARY.md

# Template to modify
@src/unifi_scanner/reports/templates/threat_section.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Cybersecure badge to detected threats section</name>
  <files>src/unifi_scanner/reports/templates/threat_section.html</files>
  <action>
In the "Threats Detected" section, add a Cybersecure badge after the category_friendly name.

Find the line (around line 43):
```html
<strong style="color: #333333; font-size: 15px; margin-left: 8px;">{{ threat.category_friendly }}</strong>
```

Add the badge conditional AFTER the strong tag:
```html
<strong style="color: #333333; font-size: 15px; margin-left: 8px;">{{ threat.category_friendly }}</strong>
{% if threat.is_cybersecure %}
<span style="display: inline-block; padding: 2px 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; color: #ffffff; background-color: #6f42c1; border-radius: 3px; margin-left: 6px;" title="Detected by CyberSecure enhanced signatures">CYBERSECURE</span>
{% endif %}
```

Badge styling:
- Background: #6f42c1 (purple - differentiates from severity badges)
- Font: 10px uppercase white
- Padding: 2px 6px (compact)
- Border-radius: 3px (matches severity badges)
- Margin-left: 6px (space from category name)
- Title tooltip: "Detected by CyberSecure enhanced signatures"
  </action>
  <verify>Read the template file and confirm the badge conditional is in the detected threats section</verify>
  <done>Detected threats section shows Cybersecure badge for threats with is_cybersecure=True</done>
</task>

<task type="auto">
  <name>Task 2: Add Cybersecure badge to blocked threats section</name>
  <files>src/unifi_scanner/reports/templates/threat_section.html</files>
  <action>
In the "Threats Blocked" section, add the same Cybersecure badge after the category_friendly name.

Find the line (around line 77):
```html
<strong style="color: #333333; font-size: 14px; margin-left: 6px;">{{ threat.category_friendly }}</strong>
```

Add the badge conditional AFTER the strong tag:
```html
<strong style="color: #333333; font-size: 14px; margin-left: 6px;">{{ threat.category_friendly }}</strong>
{% if threat.is_cybersecure %}
<span style="display: inline-block; padding: 2px 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; color: #ffffff; background-color: #6f42c1; border-radius: 3px; margin-left: 6px;" title="Detected by CyberSecure enhanced signatures">CYBERSECURE</span>
{% endif %}
```

Note: Blocked section uses slightly smaller font (14px vs 15px) but badge styling is identical.
  </action>
  <verify>Read the template file and confirm the badge conditional is in the blocked threats section</verify>
  <done>Blocked threats section shows Cybersecure badge for threats with is_cybersecure=True</done>
</task>

</tasks>

<verification>
```bash
# Verify template syntax is valid (Jinja2 will fail on render if broken)
python -c "
from jinja2 import Environment, FileSystemLoader
env = Environment(loader=FileSystemLoader('src/unifi_scanner/reports/templates'))
template = env.get_template('threat_section.html')
print('Template syntax valid')
"

# Run report tests to ensure template still renders
pytest tests/ -v -k "report" --tb=short
```
</verification>

<success_criteria>
- [ ] Badge conditional added to detected threats section
- [ ] Badge conditional added to blocked threats section
- [ ] Badge uses purple (#6f42c1) background to differentiate from severity
- [ ] Badge has title tooltip explaining "CyberSecure enhanced signatures"
- [ ] Template syntax is valid (no Jinja2 errors)
- [ ] Existing report tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/12-cybersecure-integration/12-03-SUMMARY.md`
</output>
