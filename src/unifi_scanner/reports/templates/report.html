{% extends "base.html" %}

{% block header %}
<table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
    <tr>
        <td>
            <h1 style="margin: 0 0 10px 0; color: #ffffff; font-size: 24px; font-weight: 600;">{{ report_title }}</h1>
            <p style="margin: 0; color: #ffffff; font-size: 14px; opacity: 0.9;">{{ site_name }}</p>
        </td>
    </tr>
    <tr>
        <td style="padding-top: 15px;">
            <p style="margin: 0; color: #ffffff; font-size: 12px; opacity: 0.8;">
                Period: {{ period_start }} - {{ period_end }}
            </p>
            <p style="margin: 5px 0 0 0; color: #ffffff; font-size: 12px; opacity: 0.8;">
                Generated: {{ generated_at }}
            </p>
        </td>
    </tr>
</table>
{% endblock %}

{% block content %}
<!-- Executive Summary -->
{% include "components/executive_summary.html" %}

<!-- Findings by Severity -->

{% if severe_findings %}
<!-- SEVERE Findings -->
<div style="margin-top: 30px;">
    {% set severity = "severe" %}
    {% set findings = severe_findings %}
    {% set count = counts.severe_count %}
    {% include "components/severity_section.html" %}
</div>
{% endif %}

{% if medium_findings %}
<!-- MEDIUM Findings -->
<div style="margin-top: 30px;">
    {% set severity = "medium" %}
    {% set findings = medium_findings %}
    {% set count = counts.medium_count %}
    {% include "components/severity_section.html" %}
</div>
{% endif %}

{% if low_findings %}
<!-- LOW Findings (Collapsible) -->
<div style="margin-top: 30px;">
    <input type="checkbox" id="toggle-low" style="position: absolute; left: -9999px;" />
    <label for="toggle-low" style="cursor: pointer; color: #2282FF; text-decoration: underline; font-weight: 500; display: inline-block; padding: 10px 0;">
        Show LOW severity findings ({{ counts.low_count }})
    </label>
    <div class="low-content" style="display: none;">
        {% set severity = "low" %}
        {% set findings = low_findings %}
        {% set count = counts.low_count %}
        {% include "components/severity_section.html" %}
    </div>
</div>
{% endif %}

<!-- Security Threat Summary (IPS Analysis) -->
{% include "threat_section.html" %}

<!-- Device Health Summary -->
{% include "health_section.html" %}

{# Cloudflare Security Section (optional integration) #}
{% if integrations and integrations.has_data %}
    {% set cf_section = integrations.get_section('cloudflare') %}
    {% if cf_section and cf_section.success and cf_section.data %}
        {% with cloudflare=cf_section.data %}
            {% include "cloudflare_section.html" %}
        {% endwith %}
    {% elif cf_section and not cf_section.success %}
    <!-- Cloudflare integration error -->
    <div style="margin-top: 30px; padding: 15px; background-color: #fff3cd; border-left: 4px solid #ffc107; border-radius: 0 4px 4px 0;">
        <p style="margin: 0; color: #856404; font-size: 14px;">
            <strong>&#9888; Cloudflare Data Unavailable</strong><br>
            {{ cf_section.error_message }}
        </p>
    </div>
    {% endif %}
{% endif %}

{% endblock %}
